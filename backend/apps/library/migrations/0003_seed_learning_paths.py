# Generated by Django - Data migration for Learning Paths and Units
"""
Seeds Learning Paths with phoneme units for the Pronunciation Quest game system.

Three difficulty paths:
1. Sound Explorer (Beginner) - Basic vowels and common consonants
2. Fluency Adventurer (Intermediate) - Tricky consonants, clusters  
3. Pronunciation Champion (Advanced) - Diphthongs, difficult blends
"""

from django.db import migrations


def create_learning_paths(apps, schema_editor):
    LearningPath = apps.get_model('library', 'LearningPath')
    PhonemeUnit = apps.get_model('library', 'PhonemeUnit')
    UnitPhoneme = apps.get_model('library', 'UnitPhoneme')
    Phoneme = apps.get_model('library', 'Phoneme')
    
    # Create Learning Paths
    path1 = LearningPath.objects.create(
        name='Sound Explorer',
        difficulty='beginner',
        description='Start your journey with basic sounds. Master the fundamentals of English pronunciation.',
        unlock_criteria_accuracy=0,
        order=1
    )
    
    path2 = LearningPath.objects.create(
        name='Fluency Adventurer',
        difficulty='intermediate',
        description='Level up your pronunciation with challenging consonant clusters and connected speech.',
        unlock_criteria_accuracy=70,
        unlock_criteria_previous_path=path1,
        order=2
    )
    
    path3 = LearningPath.objects.create(
        name='Pronunciation Champion',
        difficulty='advanced',
        description='Become a master of intonation, rhythm, and natural fluency. The final challenge awaits!',
        unlock_criteria_accuracy=85,
        unlock_criteria_previous_path=path2,
        order=3
    )
    
    # Path 1 Units - Sound Explorer (Beginner)
    unit1_1 = PhonemeUnit.objects.create(
        learning_path=path1,
        name='Short Vowels',
        description='Master the fundamental short vowel sounds',
        order=1,
        icon='volume-2'
    )
    
    unit1_2 = PhonemeUnit.objects.create(
        learning_path=path1,
        name='Long Vowels',
        description='Learn the stretched vowel sounds',
        order=2,
        icon='music',
        unlock_criteria_previous_unit=unit1_1
    )
    
    unit1_3 = PhonemeUnit.objects.create(
        learning_path=path1,
        name='Basic Consonants',
        description='Common consonant sounds for everyday speech',
        order=3,
        icon='mic',
        unlock_criteria_previous_unit=unit1_2
    )
    
    unit1_4 = PhonemeUnit.objects.create(
        learning_path=path1,
        name='More Consonants',
        description='Expand your consonant repertoire',
        order=4,
        icon='speaker',
        unlock_criteria_previous_unit=unit1_3
    )
    
    unit1_5 = PhonemeUnit.objects.create(
        learning_path=path1,
        name='Nasal Sounds',
        description='The M, N, and NG sounds',
        order=5,
        icon='wind',
        unlock_criteria_previous_unit=unit1_4
    )
    
    # Path 2 Units - Fluency Adventurer (Intermediate)
    unit2_1 = PhonemeUnit.objects.create(
        learning_path=path2,
        name='Fricatives',
        description='Master the flowing consonant sounds like F, V, S, Z',
        order=1,
        icon='zap'
    )
    
    unit2_2 = PhonemeUnit.objects.create(
        learning_path=path2,
        name='The TH Sounds',
        description='Conquer the tricky TH voiced and unvoiced',
        order=2,
        icon='target',
        unlock_criteria_previous_unit=unit2_1
    )
    
    unit2_3 = PhonemeUnit.objects.create(
        learning_path=path2,
        name='R and L Mastery',
        description='Perfect the challenging R and L sounds',
        order=3,
        icon='star',
        unlock_criteria_previous_unit=unit2_2
    )
    
    unit2_4 = PhonemeUnit.objects.create(
        learning_path=path2,
        name='Consonant Clusters',
        description='Handle two or more consonants together',
        order=4,
        icon='layers',
        unlock_criteria_previous_unit=unit2_3
    )
    
    unit2_5 = PhonemeUnit.objects.create(
        learning_path=path2,
        name='Word Stress',
        description='Learn where to place emphasis in words',
        order=5,
        icon='activity',
        unlock_criteria_previous_unit=unit2_4
    )
    
    # Path 3 Units - Pronunciation Champion (Advanced)
    unit3_1 = PhonemeUnit.objects.create(
        learning_path=path3,
        name='Diphthongs',
        description='Master the gliding vowel combinations',
        order=1,
        icon='trending-up'
    )
    
    unit3_2 = PhonemeUnit.objects.create(
        learning_path=path3,
        name='Affricates',
        description='Perfect the CH and J sounds',
        order=2,
        icon='shield',
        unlock_criteria_previous_unit=unit3_1
    )
    
    unit3_3 = PhonemeUnit.objects.create(
        learning_path=path3,
        name='Connected Speech',
        description='Sound natural with linked words',
        order=3,
        icon='link',
        unlock_criteria_previous_unit=unit3_2
    )
    
    unit3_4 = PhonemeUnit.objects.create(
        learning_path=path3,
        name='Sentence Intonation',
        description='Master the music of English sentences',
        order=4,
        icon='git-branch',
        unlock_criteria_previous_unit=unit3_3
    )
    
    unit3_5 = PhonemeUnit.objects.create(
        learning_path=path3,
        name='Fluency Challenge',
        description='The ultimate test of natural pronunciation',
        order=5,
        icon='award',
        unlock_criteria_previous_unit=unit3_4
    )
    
    # Map phonemes to units (get existing phonemes by ARPAbet)
    phoneme_mappings = {
        # Path 1 - Beginner
        unit1_1: ['AE', 'EH', 'IH', 'AA', 'AH'],  # Short vowels
        unit1_2: ['IY', 'EY', 'AY', 'OW', 'UW'],  # Long vowels
        unit1_3: ['P', 'B', 'T', 'D', 'K', 'G'],  # Plosives
        unit1_4: ['S', 'Z', 'F', 'V', 'HH'],       # Common fricatives
        unit1_5: ['M', 'N', 'NG'],                # Nasals
        
        # Path 2 - Intermediate
        unit2_1: ['SH', 'ZH', 'CH', 'JH'],        # Fricatives/Affricates
        unit2_2: ['TH', 'DH'],                    # TH sounds
        unit2_3: ['R', 'L'],                      # Liquids
        unit2_4: ['W', 'Y'],                      # Glides (for clusters)
        unit2_5: ['ER'],                          # Stress marker
        
        # Path 3 - Advanced  
        unit3_1: ['AW', 'OY', 'AO'],              # Diphthongs
        unit3_2: ['UH', 'AX'],                    # Reduced vowels
        unit3_3: ['IY', 'AE', 'R'],               # Connected speech practice
        unit3_4: ['OW', 'EY', 'AY'],              # Intonation practice
        unit3_5: ['TH', 'R', 'L', 'SH'],          # Final challenge
    }
    
    for unit, arpabets in phoneme_mappings.items():
        for order, arpabet in enumerate(arpabets, start=1):
            phoneme = Phoneme.objects.filter(arpabet=arpabet).first()
            if phoneme:
                UnitPhoneme.objects.create(
                    unit=unit,
                    phoneme=phoneme,
                    order=order
                )


def remove_learning_paths(apps, schema_editor):
    LearningPath = apps.get_model('library', 'LearningPath')
    LearningPath.objects.all().delete()


class Migration(migrations.Migration):

    dependencies = [
        ('library', '0002_learningpath_phonemeunit_unitphoneme_and_more'),
    ]

    operations = [
        migrations.RunPython(create_learning_paths, remove_learning_paths),
    ]
